<!DOCTYPE html>
<html lang="en">

<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />

  <!-- Open Graph / Facebook -->
  <meta property="og:type" content="website">
  <meta property="og:url" content="https://krolok.pics">
  <meta property="og:title" content="Krolok Fanpage">
  <meta property="og:description" content="krolok & others fanpage">
  <meta property="og:image" content="https://s3.eu-central-1.amazonaws.com/krolok.pics/krolok.jpg">

  <!-- Twitter -->
  <meta property="twitter:card" content="summary_large_image">
  <meta property="twitter:url" content="https://krolok.pics">
  <meta property="twitter:title" content="Krolok Fanpage">
  <meta property="twitter:description" content="krolok & others fanpage">
  <meta property="twitter:image" content="https://s3.eu-central-1.amazonaws.com/krolok.pics/krolok.jpg">

  <!-- Other meta tags -->
  <meta name="description" content="krolok & others fanpage">
  <meta name="keywords" content="Krolok, Batman, Kudłata, memorial, images">
  <meta name="author" content="DuckyBlender">

  <title>Krolok Memorian Page</title>
  <style>
    * {
      margin-top: 10px;
      margin-bottom: 10px;
      font-family: "Comic Sans MS", "Comic Sans", cursive;
    }

    body {
      background-color: magenta;
      margin: 0;
    }

    #preloader {
      background-color: yellow;
      max-width: 768px;
      margin: 0 auto;
      text-align: center;
      padding: 20px;
    }

    #website {
      background-color: green;
      text-align: center;
      display: none;
      padding: 20px;
    }

    nav a {
      margin-right: 20px;
      text-decoration: none;
      color: white;
      font-weight: bold;
      cursor: pointer;
    }

    nav a:hover {
      text-decoration: underline;
    }

    .image-gallery {
      display: flex;
      flex-wrap: wrap;
      justify-content: center;
    }

    .image-gallery div {
      width: 100%;
      padding: 10px;
      box-sizing: border-box;
    }

    @media (min-width: 576px) {
      .image-gallery div {
        width: 50%;
      }
    }

    @media (min-width: 768px) {
      .image-gallery div {
        width: 33.33%;
      }
    }

    @media (min-width: 992px) {
      .image-gallery div {
        width: 25%;
      }
    }

    .image-gallery img {
      width: 100%;
      height: auto;
      aspect-ratio: 1/1;
      object-fit: cover;
    }

    #loading {
      display: none;
      text-align: center;
      padding: 20px;
    }

    .spinner {
      border: 4px solid #f3f3f3;
      border-top: 4px solid #3498db;
      border-radius: 50%;
      width: 40px;
      height: 40px;
      animation: spin 1s linear infinite;
      margin: 20px auto;
    }

    @keyframes spin {
      0% {
        transform: rotate(0deg);
      }

      100% {
        transform: rotate(360deg);
      }
    }
  </style>
</head>

<body>
  <header>
    <audio id="track" src="track.mp3" preload="auto" loop></audio>
  </header>

  <nav>
    <center>
      <a onclick="changePage('krolok')">Krolok</a>
      <a onclick="changePage('batman')">Batman</a>
      <a onclick="changePage('kudlata')">Kudłata</a>
    </center>
  </nav>

  <main>
    <section id="preloader">
      <img src="https://s3.eu-central-1.amazonaws.com/krolok.pics/krolok.jpg" alt="Krolok Przycisk"
        onclick="runPreloader()" width="60%" />
      <h1>Krolok jest samotny</h1>
      <p>poglasz go pls <i>kliknij debilu</i> (włącz dźwięk)</p>
    </section>

    <section id="website">
      <h1 id="folderTitle"></h1>
      <p>zostaw go w spokoju</p>
      <br>
      <p>w miedzyczasie mozesz poogladac jego zdjecia</p>

      <div id="loading">
        <div class="spinner"></div>
      </div>

      <div class="image-gallery"></div>
    </section>
  </main>

  <script>
    let currentFolder = 'krolok';
    let isFirstVisit = !localStorage.getItem('visited');

    function changePage(folder) {
      console.log(`Changing to folder: ${folder}`);
      currentFolder = folder;
      updateFolderTitle();
      fetchImages();
      history.pushState(null, '', `?folder=${folder}`);
    }

    function updateFolderTitle() {
      document.getElementById('folderTitle').textContent = `${currentFolder} jest zadowolony`;
    }

    function fetchImages() {
      console.log(`Fetching images for folder: ${currentFolder}`);
      document.getElementById("loading").style.display = "block";
      document.querySelector(".image-gallery").innerHTML = "";

      fetch(
        "https://ag2znq4o7it75bgum5a3go6z4i0aovsv.lambda-url.eu-central-1.on.aws/",
        {
          method: "POST",
          body: JSON.stringify({ folder_name: currentFolder }),
          headers: {
            "Content-Type": "application/json",
          },
        }
      )
        .then((res) => {
          if (!res.ok) {
            throw new Error(`HTTP error! status: ${res.status}`);
          }
          return res.json();
        })
        .then((res) => {
          console.log(`Received ${res.image_urls.length} images`);
          const images = res.image_urls;
          const gallery = document.querySelector(".image-gallery");

          let html = "";
          images.forEach((url) => {
            html += `
              <div>
                <img src="${url}" alt="Image" loading="lazy">
              </div>
            `;
          });


          if (images.length === 0) {
            html = "<p>brak zdjec :(</p>";
          }

          gallery.innerHTML = html;
        })
        .catch((error) => {
          console.error("Error fetching images:", error);
          document.querySelector(".image-gallery").innerHTML = "<p>zdjecia broken :(</p>";
        })
        .finally(() => {
          document.getElementById("loading").style.display = "none";
        });
    }

    function imageLoaded(imgElement) {
      imgElement.src = imgElement.getAttribute("data-src");
    }

    function runPreloader() {
      document.getElementById("track").play().catch(e => {
        console.error("Audio autoplay was prevented:", e);
      });
      runWebsite();
    }

    function runWebsite() {
      document.getElementById("website").style.display = "block";
      document.getElementById("preloader").style.display = "none";
      updateFolderTitle();
      fetchImages();
      localStorage.setItem('visited', 'true');
    }

    // Initial setup
    window.onload = function () {
      const urlParams = new URLSearchParams(window.location.search);
      const folderParam = urlParams.get('folder');

      if (folderParam) {
        console.log(`URL parameter folder: ${folderParam}`);
        currentFolder = folderParam;
        runWebsite();
      } else if (!isFirstVisit) {
        console.log('Not first visit, skipping preloader');
        runWebsite();
      } else {
        console.log('First visit, showing preloader');
        document.getElementById("preloader").style.display = "block";
      }
    };

    // Handle browser back/forward
    window.onpopstate = function () {
      const urlParams = new URLSearchParams(window.location.search);
      const folderParam = urlParams.get('folder');
      if (folderParam) {
        currentFolder = folderParam;
        updateFolderTitle();
        fetchImages();
      }
    };
  </script>
</body>

</html>